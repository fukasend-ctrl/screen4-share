<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS PLAYER - LIVE</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        body{margin:0;background:#000;height:100vh;display:flex;align-items:center;overflow:hidden;} 
        canvas{width:100%;height:100%;object-fit:contain;}
        #ui{position:fixed;top:10px;left:10px;color:#00ff41;font-family:monospace;z-index:10;background:rgba(0,0,0,0.5);padding:10px;}
    </style>
</head>
<body>
    <div id="ui">STATUS: INITIALIZING...</div>
    <canvas id="view"></canvas>
<script>
    // ✅ 最新のトンネルURLを反映済み
    const TUNNEL_URL = "https://out-binding-spirits-chest.trycloudflare.com";
    
    const socket = io(TUNNEL_URL, { transports: ['websocket'], reconnection: true });
    const canvas = document.getElementById('view');
    const ctx = canvas.getContext('2d', { alpha: false });
    const ui = document.getElementById('ui');
    const img = new Image();
    let lastUrl = null;

    canvas.width = 1280; canvas.height = 720;

    socket.on('connect', () => ui.innerText = "STATUS: CONNECTED (WAITING)");
    socket.on('connect_error', (err) => ui.innerText = "ERROR: " + err.message);
    
    socket.on('view-stream', (data) => {
        if (lastUrl) URL.revokeObjectURL(lastUrl);
        const blob = new Blob([data], { type: 'image/jpeg' });
        lastUrl = URL.createObjectURL(blob);
        img.onload = () => {
            ctx.drawImage(img, 0, 0, 1280, 720);
            ui.innerText = "● LIVE - HQ 720p";
        };
        img.src = lastUrl;
    });

    socket.on('stream-status', (data) => {
        if(!data.live) {
            ctx.clearRect(0,0,1280,720);
            ui.innerText = "STATUS: HOST OFFLINE";
        }
    });
</script>
</body>
</html>
